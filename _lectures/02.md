# HTTP

# Что такое HTTP?

**HTTP** — широко распространённый протокол передачи данных, изначально предназначенный для передачи гипертекстовых документов (то есть документов, которые могут содержать ссылки, позволяющие организовать переход к другим документам).

Аббревиатура HTTP расшифровывается как *HyperText Transfer Protocol*, «протокол передачи гипертекста». В соответствии со спецификацией [OSI](http://en.wikipedia.org/wiki/OSI_model), HTTP является протоколом прикладного (верхнего, 7-го) уровня. Актуальная на данный момент версия протокола, HTTP 1.1, описана в спецификации [RFC 2616](http://tools.ietf.org/html/rfc2616).

Протокол HTTP предполагает использование клиент-серверной структуры передачи данных. Клиентское приложение формирует запрос и отправляет его на сервер, после чего серверное программное обеспечение обрабатывает данный запрос, формирует ответ и передаёт его обратно клиенту. После этого клиентское приложение может продолжить отправлять другие запросы, которые будут обработаны аналогичным образом.

Задача, которая традиционно решается с помощью протокола HTTP — обмен данными между пользовательским приложением, осуществляющим доступ к веб-ресурсам (обычно это веб-браузер) и веб-сервером. На данный момент именно благодаря протоколу HTTP обеспечивается работа Всемирной паутины.


# Клиент-Сервер
## Клиент

Клиент (user agent) — это любой инструмент или устройство, действующие от лица пользователя. Эту задачу преимущественно выполняет веб-браузер; в некоторых случаях участниками выступают программы, которые используются инженерами и веб-разработчиками для отладки своих приложений.

Браузер **всегда** является той сущностью, которая создаёт запрос. Сервер обычно этого не делает, хотя за многие годы существования сети были придуманы способы, которые могут позволить выполнить запросы со стороны сервера.

Чтобы отобразить веб страницу, браузер отправляет начальный запрос для получения HTML-документа этой страницы. После этого браузер изучает этот документ, и запрашивает дополнительные файлы, необходимые для отбражения содержания веб-страницы (исполняемые скрипты, информацию о макете страницы - CSS таблицы стилей, дополнительные ресурсы в виде изображений и видео-файлов), которые непосредственно являются частью исходного документа, но расположены в других местах сети. Далее браузер соединяет все эти ресурсы для отображения их пользователю в виде единого документа — веб-страницы. Скрипты, выполняемые самим браузером, могут получать по сети дополнительные ресурсы на последующих этапах обработки веб-страницы, и браузер соответствующим образом обновляет отображение этой страницы для пользователя.



## Сервер

На другой стороне коммуникационного канала расположен сервер, который обслуживает (англ. *serve*) пользователя, предоставляя ему документы по запросу. С точки зрения конечного пользователя, сервер всегда является некой одной виртуальной машиной, полностью или частично генерирующей документ, хотя фактически он может быть группой серверов, между которыми балансируется нагрузка, то есть перераспределяются запросы различных пользователей, либо сложным программным обеспечением, опрашивающим другие компьютеры (такие как кэширующие серверы, серверы баз данных, серверы приложений электронной коммерции и другие).

Сервер не обязательно расположен на одной машине, и наоборот - несколько серверов могут быть расположены (хоститься) на одной и той же машине. В соответствии с версией HTTP/1.1 и имея [Host](https://developer.mozilla.org/ru/docs/Web/HTTP/Headers/Host) заголовок, они даже могут делить тот же самый IP-адрес.


# HTTP Запросы

Сообщения HTTP состоят из текстовой информации в кодировке ASCII, записанной в несколько строк.
Вот пример запроса:

    GET / HTTP/1.1
    Host: developer.mozilla.org
    Accept-Language: fr

И ответа:

    HTTP/1.1 200 OK
    Date: Sat, 09 Oct 2010 14:28:02 GMT
    Server: Apache
    Last-Modified: Tue, 01 Dec 2009 20:18:22 GMT
    ETag: "51142bc1-7449-479b075b2891b"
    Accept-Ranges: bytes
    Content-Length: 29769
    Content-Type: text/html
    
    <!DOCTYPE html... (here comes the 29769 bytes of the requested web page)

Давайте разберемся, что же это за строки текста такие.
HTTP запросы и ответы имеют близкую структуру. Они состоят из:

1. Стартовой строки, описывающей запрос, или статус (успех или сбой). Это всегда одна строка.
2. Произвольного набора *HTTP заголовков*, определяющих запрос или описывающих тело сообщения.
3. Пустой строки, указывающей, что вся мета информация отправлена.
4. Произвольного тела, содержащего пересылаемые с запросом данные (например, содержимое HTML-формы ) или отправляемый в ответ документ. Наличие тела и его размер определяется стартовой строкой и заголовками HTTP.

Стартовую строку вместе с заголовками сообщения HTTP называют *головой* запроса, а его данные - *телом*.


![Requests and responses share a common structure in HTTP](./images/request-response-example.png)



# Структура HTTP запроса
## Стартовая строка

Стартовая строка состоит из 3х частей:

1. Метод. глагол (например, `GET`, `PUT` или `POST`) или существительное (например,  `HEAD` или `OPTIONS`), описывающие требуемое действие. 
2. *Цель запроса*, обычно `URL`, или абсолютный путь протокола, порт и домен обычно характеризуются контекстом запроса. Формат цели запроса зависит от используемого HTTP-метода. Это может быть
    - Абсолютный путь, за которым следует `'?'` и строка запроса. Это самая распространенная форма, называемая *исходной формой* (*origin form*) . Используется с методами `GET`, `POST`, `HEAD`, и `OPTIONS`.
        - `POST / HTTP 1.1`
        - `GET /background.png HTTP/1.0`
        - `HEAD /test.html?query=alibaba HTTP/1.1`
        - `OPTIONS /anypage.html HTTP/1.0`
    - Полный URL *- абсолютная форма* (*absolute form*) , обычно используется с `GET` при подключении к прокси.
        - `GET HTTP/1.1`
    - Компонента URL "authority", состоящая из имени домена и (необязательно) порта (предваряемого символом `':'`), *называется authority form*. Используется только с методом `CONNECT` при установке туннеля HTTP.
        - `CONNECT developer.mozilla.org:80 HTTP/1.1`
    - Форма звездочки (*asterisk form)*, просто "звездочка" (`'*'`) используется `с методом OPTIONS` и представляет сервер.
        - `OPTIONS * HTTP/1.1`
3. *Версия HTTP*, определяющая структуру оставшегося сообщения, указывая, какую версию предполагается использовать для ответа.


## Заголовки

Заголовки запроса HTTP имеют стандартную для заголовка HTTP структуру: не зависящая от регистра строка, завершаемая (`':'`) и значение, структура которого определяется заголовком. Весь заголовок, включая значение, представляет собой одну строку, которая может быть довольно длинной.
Существует множество заголовков запроса. Их можно разделить на несколько групп:

- *Основные заголовки (General headers*), например, `Via`,  относящиеся к сообщению в целом
- *Заголовки запроса (Request headers*), например, `User-Agent`, `Accept-Type`, уточняющие запрос (как, например, `Accept-Language`), придающие контекст (как `Referer`), или накладывающие ограничения на условия (like `If-None`).
- *Заголовки сущности*, например `Content-Length`, относящиеся к телу сообщения. Как легко понять, они отсутствуют, если у запроса нет тела.

![Example of headers in an HTTP request](https://cloclo24.cloud.mail.ru/weblink/view/Urms/eEGCe6wyH?etag=EB2350BAEC46C5945B82431C9B819087287F9857)

## Тело

Последней частью запроса является его тело. Оно бывает не у всех запросов: запросы, собирающие (fetching) ресурсы, такие как `GET`, `HEAD`, `DELETE`, или `OPTIONS`, в нем обычно не нуждаются. Но некоторые запросы отправляют на сервер данные для обновления, как это часто бывает с запросами `POST` (содержащими данные HTML-форм).
Тела можно грубо разделить на две категории:

- Одноресурсные тела (Single-resource bodies), состоящие из одного отдельного файла, определяемого двумя заголовками: `Content-Type` и `Content-Length`.
- [Многоресурсные тела (Multiple-resource bodies)](https://developer.mozilla.org/ru/docs/Web/HTTP/Basics_of_HTTP/MIME_types#multipartform-data), состоящие из множества частей, каждая из которых содержит свой бит информации. Они обычно связаны с [HTML-формами](https://developer.mozilla.org/ru/docs/Web/Guide/HTML/Forms) .


# Структура HTTP ответа
## Строка статуса

Стартовая строка ответа HTTP, называемая строкой статуса, содержит следующую информацию:

1. *Версию протокола*, `обычно HTTP/1.1`.
2. *Код состояния (status code)*, показывающая, был ли запрос успешным. Примеры: `200`, `404` или `302`
3. *Пояснение (status text*). Краткое текстовое описание кода состояния, помогающее пользователю понять сообщение HTTP..

Пример строки статуса: `HTTP/1.1 404 Not Found.`


## Заголовки

Заголовки ответов HTTP имеют ту же структуру, что и все остальные заголовки: не зависящая от регистра строка, завершаемая двоеточием (`':'`) и значение, структура которого определяется типом заголовка. Весь заголовок, включая значение, представляет собой одну строку.
Существует множество заголовков ответов. Их можно разделить на несколько групп:

- *Основные заголовки (General headers*), например, `Via`,  относящиеся к сообщению в целом.
- *Заголовки ответа (Response headers*), например, `Vary` и `Accept-Ranges`, сообщающие дополнительную информацию о сервере, которая не уместилась в строку состояния.
- *Заголовки сущности (Entity headers*), например, `Content-Length`, относящиеся к телу ответа. Отсутствуют, если у запроса нет тела.

![Example of headers in an HTTP response](https://cloclo14.cloud.mail.ru/weblink/view/emu5/uhTcnvnzi?etag=4603EDDF5AD0B08AB5CF44C1E29DBE38BAAC4763)

## Тело ответа

Последней частью ответа является его тело. Оно есть не у всех ответов: у ответов с кодом состояния, например, `201` или `204`, оно обычно отсутствует.
Тела можно разделить на три категории:

- Одноресурсные тела (Single-resource bodies), состоящие из отдельного файла известной длины, определяемые двумя заголовками: `Content-Type` и `Content-Length`.
- Одноресурсные тела (Single-resource bodies), состоящие из отдельного файла неизвестной длины, разбитого на небольшие части (chunks) с заголовком `Transfer-Encoding`, значением которого  является `chunked`.
- Многоресурсные тела [](https://developer.mozilla.org/ru/docs/Web/HTTP/Basics_of_HTTP/MIME_types#multipartform-data)(Multiple-resource bodies), состоящие из многокомпонентного тела, каждая часть которого содержит свой сегмент информации. Они относительно редки.


# С чем можно работать при помощи HTTP запросов?

Естественная расширяемость HTTP со временем позволила большее управление и функциональность Сети. Кэш и методы аутентификации были ранними функциями в истории HTTP. Способность ослабить первоначальные ограничения, напротив, была добавлена в 2010-е.
Ниже перечислены общие функции, управляемые с HTTP.

- *Кэш.* Сервер может инструктировать прокси и клиенты: что и как долго кэшировать. Клиент может инструктировать прокси промежуточных кэшей игнорировать хранимые документы.
- *Ослабление ограничений источника.* Для предотвращения шпионских и других, нарушающих приватность, вторжений, веб-браузер обеспечивает строгое разделение между веб-сайтами. Только страницы из **того же источника** могут получить доступ к информации на веб-странице. Хотя такие ограничение нагружают сервер, заголовки HTTP могут ослабить строгое разделение на стороне сервера, позволяя документу стать частью информации с различных доменов (по причинам безопасности).
- *Аутентификация.* Некоторые страницы доступны только специальным пользователям. Базовая аутентификация может предоставляться через HTTP, либо через использование заголовка `WWW-Authenticate` и подобных ему, либо с помощью настройки спецсессии, используя куки.
- *Прокси и тунелирование.* Серверы и/или клиенты часто располагаются в интернете, и скрывают свои истинные IP-адреса от других. HTTP запросы идут через прокси для пересечения этого сетевого барьера. Не все прокси -- HTTP прокси. SOCKS-протокол, например, оперирует на более низком уровне. Другие, как, например, ftp, могут быть обработаны этими прокси.
- *Сессии.* Использование HTTP кук позволяет связать запрос с состоянием на сервере. Это создает сессию,  хотя ядро HTTP —  протокол без состояния.  Это полезно не только для корзин в интернет-магазинах, но также для любых сайтов, позволяющих пользователю настроить выход.
# Как можно слать запросы?

В этом разделе рассмотрим несколько инструментов для отправки запросов.

1. Команда `curl`. Позволяет писать HTTP запросы в консоли. Попробовать не сложно. Проверьте, установлен ли он, на Windows 10, начиная с версии 1803 он идет в базовой комплектации, если версия ниже, или вообще не винда у вас, то [[вот]](https://develop.zendesk.com/hc/en-us/articles/360001068567-Installing-and-using-cURL#install) довольно приятный гайд, как поставить и пользоваться curl’ом Запустите первую лабораторную работу или проект в папке `_examples/e2e-test` . В соседней консоли вызовите команду `curl -XGET http://localhost:3000/ping` и получите следующий результат:
![](https://paper-attachments.dropbox.com/s_EA279F0D2E08C6032B84FA119A231420FD127052C3D161FCD5E461F2F2FB07B9_1613589317187_image.png)

2. Программа Postman. Обладает гигантским набором функций, если любопытно, то вам [сюда]. Из за этого интерфейс кажется немного перегруженным, но с задачей слать запросы справляется на ура!
![](https://paper-attachments.dropbox.com/s_EA279F0D2E08C6032B84FA119A231420FD127052C3D161FCD5E461F2F2FB07B9_1613589928651_image.png)

3. Advanced REST client. Сильно менее функциональная, по сравнению с Postman, но и за счет этого и сильно проще в понимании и освоении. Выглядит так:
![](https://paper-attachments.dropbox.com/s_EA279F0D2E08C6032B84FA119A231420FD127052C3D161FCD5E461F2F2FB07B9_1613590128328_image.png)